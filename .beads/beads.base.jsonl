{"id":"ptnextjs-0089","content_hash":"6093b6aa27544fba8bc40556850c3ed6df9c0c6b1cd8d80025607ee3ffc58f13","title":"health-2: Create /api/health Basic Endpoint","description":"Create basic health check endpoint at /api/health","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T17:07:26.508054327+01:00","updated_at":"2025-11-06T17:10:11.246045651+01:00","closed_at":"2025-11-06T17:10:11.246045651+01:00","source_repo":".","labels":["docker","health-check"]}
{"id":"ptnextjs-03b1","content_hash":"3c422612ad25c1cc376c00adac7ceba654e1a89e0a28b44b6d51c8a525b2b27a","title":"test-backend-schema: Design Database Schema Tests","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.850855832+01:00","updated_at":"2025-11-04T19:53:44.845354973+01:00","closed_at":"2025-11-04T19:53:44.845354973+01:00","source_repo":"."}
{"id":"ptnextjs-0616","content_hash":"339c0d7a9d5ce62ae1d0de3589ce979e2885a55aad0f4ce8f202d4de85d51011","title":"core-3: Create docker-compose.yml Configuration","description":"Create docker-compose.yml with app service, volumes, and proxy network","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T16:56:38.870722283+01:00","updated_at":"2025-11-06T17:05:22.098455108+01:00","closed_at":"2025-11-06T17:05:22.098455108+01:00","source_repo":".","labels":["docker","infrastructure"]}
{"id":"ptnextjs-0684","content_hash":"8a70a211b57791c4dd9f3e03131dec01404664601b00c3bf64daedd42dabbd1c","title":"integ-frontend-backend: Connect Frontend to Backend APIs","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.874824069+01:00","updated_at":"2025-11-06T08:57:27.694745341+01:00","closed_at":"2025-11-06T08:57:27.694745341+01:00","source_repo":"."}
{"id":"ptnextjs-06e9","content_hash":"e33c17a7e23bbc670020aa35cb71892f284eee19255cb2de35b4233e3f0ab9b3","title":"valid-documentation: Documentation Update","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.882149095+01:00","updated_at":"2025-11-06T08:57:35.58958079+01:00","closed_at":"2025-11-06T08:57:35.58958079+01:00","source_repo":"."}
{"id":"ptnextjs-077e","content_hash":"323afbd7d33ad7f53b85915cff4d3459684c4df8a0dc4551d6d5fd7c46123d92","title":"E2E Test Suite: Tier Downgrade Request Workflow","description":"## Overview\nE2E test suite for vendor-initiated tier downgrade request workflow with data handling.\n\n## Test File\n`tests/e2e/tier-downgrade-request-workflow.spec.ts`\n\n## Test Coverage\n\n### Suite 1: Vendor Downgrade Request Submission\n**Test 1.1: Submit tier downgrade request (tier2 → tier1)**\n- Login as tier2 vendor\n- Navigate to subscription management\n- Request downgrade to tier1\n- Provide downgrade reason\n- Select data retention option\n- Verify API call succeeds\n- Verify warning messages displayed\n\n**Test 1.2: Data retention options presented**\n- Verify 'archive', 'delete', and other options shown\n- Verify explanation of each option\n- Verify vendor can select preferred option\n\n**Test 1.3: Downgrade impact preview**\n- Vendor with 3 locations requests tier2→tier1\n- System shows: \"You have 3 locations, tier1 allows 1\"\n- Vendor selects which location to keep\n- Other locations marked for archival/deletion\n\n**Test 1.4: Cannot request upgrade via downgrade endpoint**\n- Vendor tries to request higher tier via downgrade API\n- Verify validation prevents this\n\n### Suite 2: Admin Downgrade Approval\n**Test 2.1: Admin views downgrade request with impact summary**\n- Admin views pending downgrade request\n- Sees vendor's reason\n- Sees data retention choice\n- Sees impact summary (X locations affected, etc.)\n\n**Test 2.2: Admin approves downgrade with data migration**\n- Admin approves tier2→tier1 downgrade\n- System archives excess locations (keeps 1)\n- Vendor tier updated\n- Request status updated to approved\n- Verify data migration logged\n\n**Test 2.3: Admin rejects downgrade**\n- Admin rejects downgrade request\n- Provides rejection reason\n- Vendor tier unchanged\n- No data modified\n\n### Suite 3: Data Handling\n**Test 3.1: Archive data on downgrade**\n- Vendor with 'archive' option approved for downgrade\n- Excess locations moved to archived status\n- Archived data queryable but not public\n- Verify data retained in database\n\n**Test 3.2: Delete data on downgrade**\n- Vendor with 'delete' option approved for downgrade\n- Excess locations deleted permanently\n- Verify data removed from database\n- Verify cascade deletes handled\n\n**Test 3.3: Restore archived data on re-upgrade**\n- Vendor downgrades (data archived)\n- Later upgrades back to original tier\n- Archived data restored\n- Verify data integrity maintained\n\n**Test 3.4: Location limit enforcement after downgrade**\n- Vendor downgraded from tier2 to tier1\n- Tries to add 2nd location\n- Verify tier restriction prevents addition\n- Error message shown\n\n### Suite 4: Edge Cases\n**Test 4.1: Downgrade with active promotions**\n- Tier3 vendor has active promotions\n- Requests downgrade to tier2\n- System warns about promotion deactivation\n- After approval, promotions deactivated\n\n**Test 4.2: Multiple downgrades (tier3 → tier2 → tier1)**\n- Vendor downgrades from tier3 to tier2\n- After approval, requests tier2 to tier1\n- Verify both requests handled correctly\n- Verify cumulative data impact\n\n**Test 4.3: Concurrent upgrade and downgrade requests**\n- Vendor with pending downgrade tries to request upgrade\n- Verify system prevents duplicate/conflicting requests\n\n## Test Helpers\n- `seedVendorWithMultipleLocations(tier, locationCount)`\n- `submitDowngradeRequest(vendorId, targetTier, options)`\n- `approveDowngradeRequest(requestId)`\n- `getArchivedData(vendorId, dataType)`\n\n## Acceptance Criteria\n- [ ] All downgrade request submission tests passing\n- [ ] All admin approval tests passing\n- [ ] All data handling tests passing (archive, delete, restore)\n- [ ] Edge case tests passing\n- [ ] Data migration verified in database\n- [ ] Audit logs captured\n- [ ] Test helpers implemented\n- [ ] Tests run reliably in CI","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-04T14:06:39.597066098+01:00","updated_at":"2025-11-04T14:06:39.597066098+01:00","source_repo":".","labels":["e2e","testing","tier-downgrade"],"dependencies":[{"issue_id":"ptnextjs-077e","depends_on_id":"ptnextjs-897c","type":"blocks","created_at":"2025-11-04T14:06:39.607336826+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-0b57","content_hash":"5678608c2b6747347729a2c5502a9f17ad7c32c5343055e1f5b08891d79a96bb","title":"integ-api-contract: API Contract Validation","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.873525582+01:00","updated_at":"2025-11-06T08:57:26.460779554+01:00","closed_at":"2025-11-06T08:57:26.460779554+01:00","source_repo":"."}
{"id":"ptnextjs-0b83","content_hash":"741b6845dd92618cdc234481d370736a4737db016efd594ec791499333931726","title":"Add authentication middleware for vendor dashboard routes","description":"The vendor dashboard (/vendor/dashboard/*) is accessible without authentication. Need to add Next.js middleware to redirect unauthenticated users to login page. This is a security vulnerability. File: middleware.ts. Affects Test 3.5","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-03T13:57:13.59065283+01:00","updated_at":"2025-11-03T18:53:38.36827733+01:00","closed_at":"2025-11-03T18:53:38.36827733+01:00","source_repo":".","labels":["auth","middleware","security"]}
{"id":"ptnextjs-0d99","content_hash":"72047485b2c39cf90e4db35b5b6e8f0c4ffec777d31bc2f62d2523d71731d157","title":"Unit Tests: Tier Upgrade Request API Endpoints","description":"## Overview\nUnit tests for tier upgrade request API endpoints using Jest.\n\n## Test Files\n\n### 1. Vendor Endpoints Tests\n`__tests__/api/portal/tier-upgrade-request.test.ts`\n\n**Test Suite: POST /api/portal/vendors/[id]/tier-upgrade-request**\n- ✓ Successfully creates upgrade request\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not vendor's own account\n- ✓ Returns 400 if no requested tier provided\n- ✓ Returns 400 if invalid tier value\n- ✓ Returns 400 if requested tier not higher than current\n- ✓ Returns 409 if pending request already exists\n- ✓ Validates vendor exists\n- ✓ Creates request with correct data structure\n- ✓ Sets status to 'pending'\n- ✓ Records timestamp\n\n**Test Suite: GET /api/portal/vendors/[id]/tier-upgrade-request**\n- ✓ Returns current pending request if exists\n- ✓ Returns most recent request if no pending\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not vendor's own account\n- ✓ Returns 404 if no requests found\n- ✓ Includes all request fields (status, dates, reason if rejected)\n\n**Test Suite: DELETE /api/portal/vendors/[id]/tier-upgrade-request**\n- ✓ Cancels pending request successfully\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not vendor's own account\n- ✓ Returns 404 if no pending request\n- ✓ Returns 400 if request already approved/rejected\n- ✓ Updates status to 'cancelled'\n- ✓ Records cancellation timestamp\n\n### 2. Admin Endpoints Tests\n`__tests__/api/admin/tier-upgrade-requests.test.ts`\n\n**Test Suite: GET /api/admin/tier-upgrade-requests**\n- ✓ Returns list of upgrade requests\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not admin\n- ✓ Filters by status (pending/approved/rejected)\n- ✓ Filters by date range\n- ✓ Filters by vendor ID\n- ✓ Pagination works correctly\n- ✓ Sorting works (by date, vendor name)\n- ✓ Includes vendor details in response\n\n**Test Suite: PUT /api/admin/tier-upgrade-requests/[id]/approve**\n- ✓ Approves request and updates vendor tier\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not admin\n- ✓ Returns 404 if request not found\n- ✓ Returns 400 if request already approved/rejected\n- ✓ Updates request status to 'approved'\n- ✓ Records review timestamp\n- ✓ Records admin user ID\n- ✓ Updates vendor tier atomically\n- ✓ Logs tier change for audit\n\n**Test Suite: PUT /api/admin/tier-upgrade-requests/[id]/reject**\n- ✓ Rejects request with reason\n- ✓ Returns 401 if not authenticated\n- ✓ Returns 403 if not admin\n- ✓ Returns 404 if request not found\n- ✓ Returns 400 if request already approved/rejected\n- ✓ Returns 400 if no rejection reason provided\n- ✓ Updates request status to 'rejected'\n- ✓ Stores rejection reason\n- ✓ Records review timestamp\n- ✓ Records admin user ID\n- ✓ Does not update vendor tier\n\n### 3. Service Layer Tests\n`__tests__/services/TierUpgradeRequestService.test.ts`\n\n**Test Suite: TierUpgradeRequestService**\n- ✓ createRequest() validates input\n- ✓ createRequest() checks for duplicate pending requests\n- ✓ createRequest() validates tier upgrade only\n- ✓ getRequestByVendor() returns correct request\n- ✓ approveRequest() updates both request and vendor\n- ✓ approveRequest() validates request can be approved\n- ✓ rejectRequest() requires rejection reason\n- ✓ rejectRequest() does not update vendor tier\n- ✓ cancelRequest() only works on pending requests\n- ✓ listRequests() supports filtering and pagination\n\n## Test Helpers\n- Mock Payload CMS for database operations\n- Mock authentication context\n- Factory functions for creating test data:\n  - `createMockVendor()`\n  - `createMockUpgradeRequest()`\n  - `createMockAdmin()`\n\n## Acceptance Criteria\n- [ ] All vendor endpoint tests written and passing\n- [ ] All admin endpoint tests written and passing\n- [ ] Service layer tests written and passing\n- [ ] 100% code coverage for new API routes\n- [ ] Tests use proper mocking/isolation\n- [ ] Tests are fast (\u003c500ms per suite)\n- [ ] CI integration working","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-04T14:05:22.734497386+01:00","updated_at":"2025-11-04T14:05:22.734497386+01:00","source_repo":".","labels":["api","testing","unit"],"dependencies":[{"issue_id":"ptnextjs-0d99","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:05:22.753838625+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-0e8b","content_hash":"29f1efec4ed9f56563842be743dd2aff7c7985628ebe97e74358e1907632544c","title":"Implement Admin Vendor Approval API Endpoint","description":"Create POST /api/admin/vendors/[id]/approve endpoint to approve pending vendors. Updates user status from 'pending' to 'approved'. Unlocks 90% of test scenarios.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-03T09:14:47.288618875+01:00","updated_at":"2025-11-03T09:32:33.820491751+01:00","closed_at":"2025-11-03T09:32:33.820491751+01:00","source_repo":".","labels":["api","backend","e2e","testing"]}
{"id":"ptnextjs-1765","content_hash":"ec382f9ee2b194d59c336a1548730827b353d7430992107f85218cc8496a84d5","title":"test-backend-vendor-api: Design Vendor API Endpoint Tests","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.858222211+01:00","updated_at":"2025-11-04T19:53:44.851649308+01:00","closed_at":"2025-11-04T19:53:44.851649308+01:00","source_repo":"."}
{"id":"ptnextjs-1e5b","content_hash":"56d6a882746e81ecd85c7fac8bed31d7f986dc05846ce3a91dc1bb353932dd39","title":"Security enhancements for tier-upgrade system","description":"HIGH Priority: 1) Add CSP headers and security headers (X-Content-Type-Options, X-Frame-Options), 2) Add rate limiting (10 req/min), 3) Backend min length validation (rejection reason 10 chars, vendor notes 20 chars). MEDIUM: 4) Standardize error messages, 5) Production secret validation. Files: middleware.ts (create), reject/route.ts, TierUpgradeRequestService.ts, payload.config.ts","acceptance_criteria":"CSP headers implemented, rate limiting active, all input validation enforced backend, error messages standardized, security score 90/100+","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T09:48:27.473592308+01:00","updated_at":"2025-11-06T10:11:07.124064293+01:00","closed_at":"2025-11-06T10:11:07.124069753+01:00","source_repo":".","labels":["high-priority","pre-merge","security","tier-upgrade-system"]}
{"id":"ptnextjs-1e96","content_hash":"20aabb7334b732880ce3dbbd753a4d6f356a926fe3cb5b640a38ec45b3c0e83f","title":"BE-1: Install exceljs Dependency","description":"Install exceljs@^4.4.0 library for Excel file generation and parsing. Includes TypeScript types verification.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T21:59:48.94996231+01:00","updated_at":"2025-11-06T21:59:58.4205734+01:00","closed_at":"2025-11-06T21:59:58.4205734+01:00","source_repo":".","labels":["backend","dependencies","excel-import-export"]}
{"id":"ptnextjs-2bf7","content_hash":"a7e74f14700eed8753bfb6d03577742058c3690874d60603ac194e086e8ab215","title":"BE-3: Create ExcelTemplateService","description":"Generate tier-appropriate Excel templates with headers, examples, data validation, and instructions worksheet. Includes 33 unit tests with 90%+ coverage. Features: styled headers, frozen rows, dropdown validation, number ranges, text length limits.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T22:00:08.395276627+01:00","updated_at":"2025-11-06T22:00:18.19713157+01:00","closed_at":"2025-11-06T22:00:18.19713157+01:00","source_repo":".","labels":["backend","excel-import-export","services","testing"]}
{"id":"ptnextjs-2c24","content_hash":"4e2d55e7ed603759095597cc0a08bacdd1f549759dd9a5476b1deb8a99f2f7c4","title":"test-e2e-admin: Admin Workflow E2E Tests","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.877425018+01:00","updated_at":"2025-11-06T08:57:30.827278102+01:00","closed_at":"2025-11-06T08:57:30.827278102+01:00","source_repo":"."}
{"id":"ptnextjs-2f0f","content_hash":"61d44c82a958cb867b3dc1c2d87b1402baa50cc75b4b3f14ffbd3d5495f75338","title":"E2E Test Suite 02: Admin Approval Workflow","description":"Implement 5 test scenarios for admin approval. Requires admin approval API. File: tests/e2e/vendor-onboarding/02-admin-approval.spec.ts","acceptance_criteria":"✓ Test 2.1: Admin login and navigation to pending vendors\n✓ Test 2.2: Admin approves vendor\n✓ Test 2.3: Pending vendor cannot login (403 forbidden)\n✓ Test 2.4: Approved vendor can login successfully\n✓ Test 2.5: Admin rejects vendor application\n✓ Uses admin approval API endpoint\n✓ Verifies status changes in database\n✓ Tests rejection workflow with reason\n✓ All 5 tests passing\n✓ Execution time \u003c 4 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:15:16.128406137+01:00","updated_at":"2025-11-03T09:49:32.605720137+01:00","closed_at":"2025-11-03T09:49:32.605720137+01:00","source_repo":".","labels":["e2e","smoke-test","testing"],"dependencies":[{"issue_id":"ptnextjs-2f0f","depends_on_id":"ptnextjs-0e8b","type":"blocks","created_at":"2025-11-03T09:15:16.135678303+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-350a","content_hash":"3a67e2cbd72060198e2e3b017c531295c374126d7f3510e8dda8c710b93ef114","title":"Implement Vendor Reviews with hCaptcha Integration","description":"✅ IMPLEMENTATION COMPLETE AND VERIFIED\n\n**Bug Found \u0026 Fixed**:\n- Modal dialog was not rendering when reviews array was empty\n- Fixed by restructuring component to always render Dialog outside conditional\n\n**Test Results**:\n✅ Modal opens successfully\n✅ Form fields render correctly\n✅ hCaptcha widget appears\n✅ Review submission works\n✅ User confirmed feature is working\n\n**Files Modified**:\n- payload/collections/Vendors.ts (added vendorReviews field)\n- app/api/vendors/[slug]/reviews/route.ts (API endpoints)\n- components/vendors/VendorReviews.tsx (component with fix)\n- app/(site)/vendors/[slug]/page.tsx (integration)\n- lib/types.ts (VendorReview interface)\n\n**Evidence**: Playwright tests pass, screenshots saved to evidence directory","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-04T08:41:04.626204019+01:00","updated_at":"2025-11-04T09:07:39.075574903+01:00","closed_at":"2025-11-04T08:52:43.465554687+01:00","source_repo":".","labels":["api","frontend","hcaptcha","reviews","vendor"]}
{"id":"ptnextjs-3567","content_hash":"94d6258c90a48207c3669b9751a616f31e3fab3ec2e36e57c61fe057656ec504","title":"core-2: Create Multi-Stage Dockerfile","description":"Create multi-stage Dockerfile with deps, builder, and runner stages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T16:56:36.909383236+01:00","updated_at":"2025-11-06T17:03:47.571715254+01:00","closed_at":"2025-11-06T17:03:47.571715254+01:00","source_repo":".","labels":["docker","infrastructure"]}
{"id":"ptnextjs-3bd9","content_hash":"59e5ed77af7e8698bec1ee4a2e547d53f5175060317234b9c440437601f3e048","title":"Fix Vendor Profile Form Save Button Bug","description":"Profile form save button gets stuck in 'Saving...' state. Button is disabled and API call either hangs, fails silently, or response not handled. Test shows button disabled with text 'Saving...' after click but no PUT request completes.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-03T10:56:21.167912464+01:00","updated_at":"2025-11-03T11:49:28.835655386+01:00","closed_at":"2025-11-03T11:49:28.835655386+01:00","source_repo":".","labels":["bug","e2e","frontend"]}
{"id":"ptnextjs-3c99","content_hash":"46c136d357a3f05a3b1178dabcb0d3cac368216d3201b1c02da247016e5e7e43","title":"impl-frontend-status: Implement UpgradeRequestStatusCard Component","description":"Priority: 1","notes":"Component implemented with all 23 tests passing. Features: status badges, tier display, cancel functionality, date formatting, rejection reasons","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.867721799+01:00","updated_at":"2025-11-04T22:41:48.05502744+01:00","closed_at":"2025-11-04T22:41:48.05502744+01:00","source_repo":"."}
{"id":"ptnextjs-3cf0","content_hash":"63582b427fbaf7b1de086898bc7caa9032d09ee9192c6fb166b73a8311d136ea","title":"E2E Test Suite: Vendor Tier Upgrade Request Workflow","description":"## Overview\nComprehensive E2E test suite for vendor-initiated tier upgrade request workflow.\n\n## Test File\n`tests/e2e/tier-upgrade-request-workflow.spec.ts`\n\n## Test Coverage\n\n### Suite 1: Vendor Request Submission\n**Test 1.1: View tier upgrade options**\n- Login as free tier vendor\n- Navigate to subscription/upgrade page\n- Verify tier comparison table displays\n- Verify current tier is highlighted\n- Verify upgrade options shown (tier1, tier2, tier3)\n\n**Test 1.2: Submit tier upgrade request (free → tier1)**\n- Free tier vendor submits tier1 upgrade request\n- Verify API call succeeds (201)\n- Verify success toast displayed\n- Verify request status shows \"pending\"\n- Verify request appears in subscription tab\n\n**Test 1.3: Cannot submit duplicate request**\n- Vendor with pending request tries to submit another\n- Verify API returns 400/409 conflict\n- Verify error toast displayed\n- Verify UI prevents duplicate submission\n\n**Test 1.4: Cannot request downgrade**\n- Tier2 vendor tries to request tier1 or free\n- Verify UI prevents selection or API rejects\n- Verify error message shown\n\n**Test 1.5: Cancel pending upgrade request**\n- Vendor with pending request clicks cancel\n- Verify confirmation dialog\n- Verify DELETE API call succeeds\n- Verify request status updates\n- Verify can submit new request after cancellation\n\n### Suite 2: Admin Approval Workflow\n**Test 2.1: Admin views pending upgrade requests**\n- Login as admin\n- Navigate to upgrade requests management\n- Verify pending requests list displays\n- Verify filters work (status, date, tier)\n- Verify sorting works\n\n**Test 2.2: Admin approves upgrade request**\n- Admin selects pending request\n- Clicks \"Approve\" button\n- Verifies confirmation modal\n- Confirms approval\n- Verify API call succeeds\n- Verify request status updates to \"approved\"\n- Verify vendor tier updated in database\n- Verify success toast shown\n\n**Test 2.3: Verify vendor tier updated after approval**\n- Query vendor from database\n- Verify tier field updated\n- Verify tier badge displays new tier\n- Verify tier-gated features now accessible\n\n**Test 2.4: Admin rejects upgrade request**\n- Admin selects pending request\n- Clicks \"Reject\" button\n- Enters rejection reason\n- Confirms rejection\n- Verify API call succeeds\n- Verify request status updates to \"rejected\"\n- Verify rejection reason stored\n- Verify vendor tier unchanged\n\n**Test 2.5: Vendor sees rejection reason**\n- Login as rejected vendor\n- Navigate to subscription page\n- Verify request status shows \"rejected\"\n- Verify rejection reason displayed\n- Verify can submit new request\n\n### Suite 3: End-to-End Happy Path\n**Test 3.1: Complete upgrade flow (free → tier1 → tier2)**\n- Free tier vendor submits tier1 request\n- Admin approves\n- Verify tier1 features unlock\n- Vendor verifies new features accessible\n- Vendor submits tier2 request\n- Admin approves\n- Verify tier2 features unlock\n\n**Test 3.2: Complete upgrade flow with rejection**\n- Vendor submits upgrade request\n- Admin rejects with reason\n- Vendor sees rejection\n- Vendor submits new request with corrections\n- Admin approves\n- Verify tier updated\n\n### Suite 4: Edge Cases \u0026 Validation\n**Test 4.1: Request expires/stale handling**\n- Create old pending request (if time-based expiry implemented)\n- Verify system handles appropriately\n\n**Test 4.2: Concurrent request handling**\n- Vendor submits request\n- Admin starts review\n- Vendor tries to cancel\n- Verify race condition handling\n\n**Test 4.3: Invalid tier requests**\n- Try requesting invalid tier values\n- Verify validation\n\n**Test 4.4: Unauthorized access**\n- Non-admin tries to approve request\n- Verify 403 error\n- Different vendor tries to view another's request\n- Verify 403 error\n\n## Test Helpers Needed\n- `seedVendorWithUpgradeRequest()` - Create vendor with pending request\n- `approveUpgradeRequest(vendorId)` - Admin helper to approve\n- `rejectUpgradeRequest(vendorId, reason)` - Admin helper to reject\n- `getUpgradeRequestStatus(vendorId)` - Get current request status\n\n## Acceptance Criteria\n- [ ] All vendor request submission tests passing\n- [ ] All admin approval workflow tests passing\n- [ ] End-to-end happy path tests passing\n- [ ] Edge case tests passing\n- [ ] Test helpers implemented\n- [ ] Uses seed API helpers pattern\n- [ ] Proper cleanup between tests\n- [ ] Tests run reliably in CI\n- [ ] Screenshot evidence captured for key steps","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-04T14:04:55.822403677+01:00","updated_at":"2025-11-04T14:04:55.822403677+01:00","source_repo":".","labels":["e2e","testing","tier-upgrade"],"dependencies":[{"issue_id":"ptnextjs-3cf0","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:04:55.829076784+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-3cf0","depends_on_id":"ptnextjs-6909","type":"blocks","created_at":"2025-11-04T14:04:55.830714204+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-4570","content_hash":"41a23ffdd83ee5dabbe693e85083547dfb96002dba7373dbd2d8b7c23901c6f0","title":"test-e2e-vendor: Vendor Workflow E2E Tests","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.876131977+01:00","updated_at":"2025-11-06T08:57:28.892141018+01:00","closed_at":"2025-11-06T08:57:28.892141018+01:00","source_repo":"."}
{"id":"ptnextjs-45dc","content_hash":"af287208b660dc0d7564c77bad4c79f5917753c04e9607af012d690b664bfa33","title":"Fix integration tests requiring environment","description":"api-admin-endpoints.test.ts: Requires dev server running. tier-access-control.test.tsx: Mock setup incorrect (15 failures). profile-locations-display.test.tsx: Missing testid (12 failures).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-07T22:27:39.030572097+01:00","updated_at":"2025-11-08T07:21:55.675214849+01:00","closed_at":"2025-11-08T07:21:55.675214849+01:00","source_repo":".","labels":["environment","integration","testing"]}
{"id":"ptnextjs-522d","content_hash":"eea5c1fba7e724a447bc10916d1605c48dd729ba7419772a3017d8550bc34107","title":"Performance optimizations for tier-upgrade system","description":"Implement performance optimizations: 1) Fix admin endpoint URL (DONE), 2) Remove redundant API call in UpgradeRequestStatusCard, 3) Add database field selection, 4) Implement pagination, 5) Add response caching. Target: Page load 350ms-\u003e150ms, API 60ms-\u003e35ms, Payload 85KB-\u003e45KB","acceptance_criteria":"Page load \u003c150ms, API response \u003c35ms, payload \u003c45KB, all optimizations implemented and tested","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T09:48:01.848161244+01:00","updated_at":"2025-11-06T10:11:08.368985548+01:00","closed_at":"2025-11-06T10:11:08.368989798+01:00","source_repo":".","labels":["performance","pre-merge","tier-upgrade-system"],"dependencies":[{"issue_id":"ptnextjs-522d","depends_on_id":"ptnextjs-c810","type":"blocks","created_at":"2025-11-06T09:48:01.855051447+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-55e8","content_hash":"bb29a650ab7f862063dd88480602ce7a37c39016dff4afb274cc6f83b73b80cd","title":"Refactor admin approval tests to use seed helpers","description":"Tests 2.2 and 2.5 call admin API directly without auth. Should use seed helper pattern instead. Files: tests/e2e/vendor-onboarding/02-admin-approval.spec.ts, tests/e2e/helpers/seed-api-helpers.ts. Affects Tests 2.2, 2.5","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T13:57:17.893038222+01:00","updated_at":"2025-11-03T19:07:35.551320531+01:00","closed_at":"2025-11-03T19:07:35.551320531+01:00","source_repo":".","labels":["admin","refactor","testing"]}
{"id":"ptnextjs-583a","content_hash":"ea688275b81b03781cb60aad016a7a463c0ef512450e689c8ecff8f45ba7271c","title":"Add tier badge display to public vendor profiles","description":"Tier/featured badges not rendering on public vendor profile pages. Need to add SubscriptionTierBadge component to VendorHero.tsx. Affects Test 10.4. File: components/vendors/VendorHero.tsx","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-03T13:57:20.382812995+01:00","updated_at":"2025-11-03T19:00:03.487361205+01:00","closed_at":"2025-11-03T19:00:03.487361205+01:00","source_repo":".","labels":["public-profile","tier-badge","ui"]}
{"id":"ptnextjs-59ec","content_hash":"d7ee1f96da4f9ba32bf0eac95d6650af8d96d65a12b7235448d86f977220ca64","title":"Fix Registration Redirect Timeout","description":"Root cause found: Registration API was calling hashPassword() for validation, which hashes with bcrypt (12 rounds, ~250-500ms). This happened before Payload CMS also hashed the password, resulting in ~500ms-1s wasted on double hashing. Fixed by making validatePasswordStrength() public and calling it directly instead.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-03T10:56:07.557996686+01:00","updated_at":"2025-11-03T11:42:47.291376781+01:00","closed_at":"2025-11-03T11:42:47.291376781+01:00","source_repo":".","labels":["bug","e2e","performance"]}
{"id":"ptnextjs-5a07","content_hash":"2968dcfa860277bcdcfc95d4ec899bffb99aba67b397fda7959e18cfac28179d","title":"E2E Test Suite 04: Free Tier Profile","description":"Implement 6 test scenarios for free tier profile setup. File: tests/e2e/vendor-onboarding/04-free-tier-profile.spec.ts","acceptance_criteria":"✓ Test 4.1: Dashboard loads with free tier badge\n✓ Test 4.2: Edit and save basic info (name, description, phone)\n✓ Test 4.3: Free tier cannot access tier 1+ fields (upgrade prompt shown)\n✓ Test 4.4: Upload logo image successfully\n✓ Test 4.5: Form validation errors display correctly\n✓ Test 4.6: Single location limit enforced\n✓ Verifies tier restrictions working\n✓ Tests file upload functionality\n✓ All 6 tests passing\n✓ Execution time \u003c 4 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:15:18.286073074+01:00","updated_at":"2025-11-03T09:49:32.608290758+01:00","closed_at":"2025-11-03T09:49:32.608290758+01:00","source_repo":".","labels":["core-workflow","e2e","testing"]}
{"id":"ptnextjs-5b34","content_hash":"b1ae368274abda8da7f8945beae7d69ab92f13abda5819d20de3566823c0057f","title":"Add Image Fixtures for E2E Tests","description":"Add team-member.jpg, case-study-1.jpg, product-image.jpg to tests/fixtures/ directory.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:14:52.038875892+01:00","updated_at":"2025-11-03T09:43:54.368491541+01:00","closed_at":"2025-11-03T09:43:54.368491541+01:00","source_repo":".","labels":["fixtures","testing"]}
{"id":"ptnextjs-662c","content_hash":"0bce2e8054c2f320b28c6c643acdbe945a6e4f4d3e3f4a4de3ab6d29a6188aed","title":"Tier Upgrade System - Pre-Merge Quality Push","description":"Complete all remaining quality tasks before merging tier-upgrade-request-system to main. Includes unit test fixes, performance optimizations, security hardening, ESLint cleanup, and comprehensive QA validation. Target: Production-ready state with security score 90+, performance score 85+, all tests passing.","acceptance_criteria":"All child tasks completed, TypeScript compiles, build succeeds, security validated, performance optimized, ready for production deployment","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-06T09:48:43.741734127+01:00","updated_at":"2025-11-06T10:11:20.316690647+01:00","closed_at":"2025-11-06T10:11:20.316693453+01:00","source_repo":".","labels":["epic","pre-merge","quality","tier-upgrade-system"],"dependencies":[{"issue_id":"ptnextjs-662c","depends_on_id":"ptnextjs-c810","type":"blocks","created_at":"2025-11-06T09:48:43.750587237+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-662c","depends_on_id":"ptnextjs-522d","type":"blocks","created_at":"2025-11-06T09:48:43.752391467+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-662c","depends_on_id":"ptnextjs-1e5b","type":"blocks","created_at":"2025-11-06T09:48:43.754142051+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-662c","depends_on_id":"ptnextjs-bbe0","type":"blocks","created_at":"2025-11-06T09:48:43.755898638+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-662c","depends_on_id":"ptnextjs-ac78","type":"blocks","created_at":"2025-11-06T09:48:43.757486285+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-6754","content_hash":"2a72c8e6ed846da9085add1f4ca3db6b1d6fcfa65a51a6fcb5bde2648be83fb1","title":"E2E Test Suite 03: Vendor Authentication","description":"Implement 5 test scenarios for authentication flow. File: tests/e2e/vendor-onboarding/03-authentication.spec.ts","acceptance_criteria":"✓ Test 3.1: Successful login with valid credentials\n✓ Test 3.2: Login fails with invalid credentials (401)\n✓ Test 3.3: Session persistence after page reload\n✓ Test 3.4: Logout functionality clears session\n✓ Test 3.5: Protected route access redirects to login\n✓ Tests cookie-based authentication\n✓ Verifies session cookies\n✓ Tests unauthorized access handling\n✓ All 5 tests passing\n✓ Execution time \u003c 3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:15:17.292344208+01:00","updated_at":"2025-11-03T09:49:32.607042142+01:00","closed_at":"2025-11-03T09:49:32.607042142+01:00","source_repo":".","labels":["e2e","smoke-test","testing"]}
{"id":"ptnextjs-6837","content_hash":"3aa31831658d9e6a058d9e35a1736a8f5be622f773db5b1fe8675ecfb3144a76","title":"BE-2: Create Field Mapping Configuration","description":"Create lib/config/excel-field-mappings.ts with 28 vendor fields, tier-based access control, validation rules, and 9 helper functions. Includes 48 unit tests with 100% coverage.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T21:59:58.457337586+01:00","updated_at":"2025-11-06T22:00:08.363661071+01:00","closed_at":"2025-11-06T22:00:08.363661071+01:00","source_repo":".","labels":["backend","configuration","excel-import-export"]}
{"id":"ptnextjs-6858","content_hash":"824ef4668b59577dd4730c8cf610457697d65bca9154c80ff67c7a390327c8a3","title":"pre-2: Create Integration Strategy","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.847760079+01:00","updated_at":"2025-11-04T19:53:44.843970776+01:00","closed_at":"2025-11-04T19:53:44.843970776+01:00","source_repo":"."}
{"id":"ptnextjs-6909","content_hash":"f2c157f302276ebbaffa397330910816597f4501ee25aaf6b8733f2c5f5261dc","title":"Implement Vendor Dashboard Tier Upgrade UI","description":"## Overview\nCreate vendor dashboard UI for requesting tier upgrades and viewing upgrade request status.\n\n## Current State\n- ✅ `UpgradePromptCard` exists - shows \"Contact Sales\" button\n- ✅ `TierUpgradePrompt` exists - shows upgrade needed for locked features\n- ✅ Dashboard shows tier badge via `SubscriptionTierBadge`\n- ❌ No `/vendor/dashboard/subscription` route\n- ❌ No request submission form\n- ❌ No request status tracking UI\n- ❌ Upgrade buttons currently link to mailto or non-existent /subscription/upgrade\n\n## Requirements\n\n### New Components to Create\n\n1. **TierUpgradeRequestForm** (`components/dashboard/TierUpgradeRequestForm.tsx`)\n   - Tier selection (tier1, tier2, tier3 based on current)\n   - Vendor notes textarea (why upgrade is needed)\n   - Submit upgrade request button\n   - Integration with POST API endpoint\n   - Validation: prevent duplicate pending requests\n\n2. **UpgradeRequestStatusCard** (`components/dashboard/UpgradeRequestStatusCard.tsx`)\n   - Show pending request details (requested tier, date, notes)\n   - Display status badge (pending/approved/rejected)\n   - Show rejection reason if rejected\n   - Cancel request button (if status=pending)\n   - Timeline/history of request\n\n3. **TierComparisonTable** (`components/TierComparisonTable.tsx`)\n   - Responsive table showing features by tier\n   - Highlight current tier\n   - Show which features unlock at each tier\n   - Feature availability checkmarks\n   - Pricing information (if available)\n\n### Routes to Create\n- `app/(site)/vendor/dashboard/subscription/page.tsx`\n  - Main subscription management page\n  - Shows current tier status\n  - TierComparisonTable\n  - TierUpgradeRequestForm OR UpgradeRequestStatusCard (based on pending request)\n  - Links to pricing page\n\n### Components to Update\n- **UpgradePromptCard**: Change \"Contact Sales\" to navigate to `/vendor/dashboard/subscription`\n- **Dashboard sidebar**: Add link to subscription page\n- **Dashboard main**: Update tier card upgrade buttons to link to subscription page\n\n### User Flows\n1. **Request Upgrade Flow:**\n   - Vendor clicks \"Upgrade\" from dashboard or locked feature\n   - Navigates to /vendor/dashboard/subscription\n   - Views tier comparison table\n   - Selects desired tier\n   - Enters notes explaining why\n   - Submits request\n   - Sees confirmation toast\n   - Status card shows \"pending\"\n\n2. **View Status Flow:**\n   - Vendor with pending request navigates to subscription page\n   - Sees UpgradeRequestStatusCard showing pending status\n   - Can cancel request if needed\n   - After admin approval/rejection, sees updated status\n\n3. **Approved Flow:**\n   - Status updates to \"approved\"\n   - Tier badge updates throughout dashboard\n   - Features unlock automatically\n   - Success message displayed\n\n## API Integration\n- POST /api/portal/vendors/[id]/tier-upgrade-request - Submit request\n- GET /api/portal/vendors/[id]/tier-upgrade-request - Check status\n- DELETE /api/portal/vendors/[id]/tier-upgrade-request/[requestId] - Cancel\n\n## Acceptance Criteria\n- [ ] TierUpgradeRequestForm component created and functional\n- [ ] UpgradeRequestStatusCard component created\n- [ ] TierComparisonTable component created\n- [ ] `/vendor/dashboard/subscription` route created\n- [ ] UpgradePromptCard updated to link to subscription page\n- [ ] Dashboard sidebar includes subscription link\n- [ ] API integration for submitting requests works\n- [ ] API integration for viewing request status works\n- [ ] API integration for canceling requests works\n- [ ] Toast notifications for success/error\n- [ ] Responsive design (mobile-friendly)\n- [ ] Proper loading and error states\n- [ ] Cannot submit duplicate pending requests\n- [ ] Form validation (tier selection, notes)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-04T14:04:08.340699635+01:00","updated_at":"2025-11-04T14:16:23.729406551+01:00","source_repo":".","labels":["dashboard","frontend","ui"],"dependencies":[{"issue_id":"ptnextjs-6909","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:04:08.376206698+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-69ec","content_hash":"5003bd32a2685951923c5b29786ede1168751ec5393766a251b6e29b9d0ca34c","title":"Add Docker environment check for docker-stack tests","description":"docker-stack.test.ts: 33 tests hang without Docker. Add describe.skipIf(!isDockerAvailable) wrapper or environment detection.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-07T22:27:41.577588713+01:00","updated_at":"2025-11-08T07:21:54.417640988+01:00","closed_at":"2025-11-08T07:21:54.417640988+01:00","source_repo":".","labels":["docker","integration","testing"]}
{"id":"ptnextjs-6dd1","content_hash":"285037e0e21e82e3a43b12d2e5028ed475386fb97783039ed4b7a5d2a02d673c","title":"E2E Test Suite 07: Tier 2 Location Management","description":"Implement 7 test scenarios for multi-location management. File: tests/e2e/vendor-onboarding/07-tier2-locations.spec.ts","acceptance_criteria":"✓ Test 7.1: Add first location as headquarters with HQ flag\n✓ Test 7.2: Add multiple locations (up to 10 for tier 2)\n✓ Test 7.3: Edit existing location details\n✓ Test 7.4: Delete location with confirmation\n✓ Test 7.5: Geocoding integration (address to coordinates)\n✓ Test 7.6: Map preview with location markers (Leaflet)\n✓ Test 7.7: Location limit enforcement (10 max for tier 2)\n✓ Tests geocoding API integration\n✓ Verifies map display working\n✓ Enforces tier 2 location limits\n✓ All 7 tests passing\n✓ Execution time \u003c 5 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:21.936667914+01:00","updated_at":"2025-11-03T12:28:32.492162619+01:00","closed_at":"2025-11-03T12:28:32.492162619+01:00","source_repo":".","labels":["advanced-features","e2e","testing"]}
{"id":"ptnextjs-74d6","content_hash":"ba977006b4ffaac5983c6f321de5b7d38a9e0d903dca2f619be9f92ac128ead4","title":"Fix location/map feature tests (5 test files, ~50 failing tests)","description":"LocationsDisplaySection.test.tsx: 11 failures - Leaflet mock spreading boolean props to DOM. LocationSearchFilter.test.tsx: 15 failures - Missing loading state, result handling. LocationResultSelector.test.tsx: Missing Dialog description. locations-workflow.test.tsx: Test timeout. location-search-workflow.test.tsx: 5 failures - event handlers not wired.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T22:27:36.824871996+01:00","updated_at":"2025-11-08T07:21:56.791509334+01:00","closed_at":"2025-11-08T07:21:56.791509334+01:00","source_repo":".","labels":["locations","maps","testing"]}
{"id":"ptnextjs-7c9a","content_hash":"34dfb3545840059f700ed9635b4443ce868650cb808769e0f5aa488275dffbfb","title":"core-1: Write Docker Stack Integration Tests (RED)","description":"Write comprehensive integration tests for Docker stack BEFORE implementation (TDD RED phase)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T16:56:35.362256955+01:00","updated_at":"2025-11-06T17:02:06.328549387+01:00","closed_at":"2025-11-06T17:02:06.328549387+01:00","source_repo":".","labels":["docker","tdd","testing"]}
{"id":"ptnextjs-7dc5","content_hash":"0a98f42d142ef89efb4006558579f35228cbcab21d870f6bce98db91761942fc","title":"impl-backend-admin-api: Implement Admin API Endpoints","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.862104783+01:00","updated_at":"2025-11-04T19:54:03.815982919+01:00","closed_at":"2025-11-04T19:54:03.815982919+01:00","source_repo":"."}
{"id":"ptnextjs-8093","content_hash":"7a3ff7c40e2129259c7515b8f1f0f60a56a040a026d04a32b69d6f978c835b52","title":"E2E Test Suite 05: Tier Upgrade Flow","description":"Implement 6 test scenarios for tier upgrades. Requires tier upgrade API. File: tests/e2e/vendor-onboarding/05-tier-upgrade.spec.ts","acceptance_criteria":"✓ Test 5.1: View tier upgrade options and pricing\n✓ Test 5.2: Upgrade from free to tier 1 (simulated payment)\n✓ Test 5.3: Tier 1 features unlocked after upgrade\n✓ Test 5.4: Upgrade from tier 1 to tier 2\n✓ Test 5.5: Upgrade to tier 3 enterprise\n✓ Test 5.6: Cannot downgrade tier (validation prevents)\n✓ Uses tier upgrade API endpoint\n✓ Verifies feature unlocking\n✓ All 6 tests passing\n✓ Execution time \u003c 5 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:19.626191134+01:00","updated_at":"2025-11-03T10:49:46.941129214+01:00","closed_at":"2025-11-03T10:49:46.941129214+01:00","source_repo":".","labels":["core-workflow","e2e","testing"],"dependencies":[{"issue_id":"ptnextjs-8093","depends_on_id":"ptnextjs-9505","type":"blocks","created_at":"2025-11-03T09:15:19.635277924+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-81b8","content_hash":"fb2e32cd542e4cb839322acdacbde02563fc1e689e47f1477f23e660f08fbdf3","title":"Fix ISR configuration for dynamic vendor public profiles","description":"Public vendor profile pages (/vendors/[slug]/) return 404 for test-seeded vendors. Need to add dynamicParams=true and revalidate config. File: app/(site)/vendors/[slug]/page.tsx. Affects Test 4.4","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-03T13:57:15.693968665+01:00","updated_at":"2025-11-03T18:58:08.471505692+01:00","closed_at":"2025-11-03T18:58:08.471505692+01:00","source_repo":".","labels":["ISR","public-profile","routing"]}
{"id":"ptnextjs-8515","content_hash":"d00ef94d935bed2bed0193ad759b785cfd7ff934648e0d20497ce43e7f84921c","title":"impl-frontend-form: Implement TierUpgradeRequestForm Component","description":"Priority: 1","notes":"All 28 tests passing. Fixed: 1) Added jsdom polyfills (hasPointerCapture, scrollIntoView), 2) Updated selectTier helper to handle multiple text matches (hidden option + visible portal span), 3) Added mode:'onBlur' to form for real-time validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.866307435+01:00","updated_at":"2025-11-04T22:29:15.492682479+01:00","closed_at":"2025-11-04T22:29:15.492682479+01:00","source_repo":"."}
{"id":"ptnextjs-870a","content_hash":"ff24ad1ac4a92aa1c58d601eb2a022b261f37a14262f1afec523837b0c0cc8fb","title":"valid-performance: Performance Validation","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.880257444+01:00","updated_at":"2025-11-06T08:57:34.081943763+01:00","closed_at":"2025-11-06T08:57:34.081943763+01:00","source_repo":"."}
{"id":"ptnextjs-8868","content_hash":"ed2c1f1d8f11470a90911d160b4f13714e27c863df550bc522c7ebe820d4b725","title":"test-backend-service: Design Service Layer Tests","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.855609952+01:00","updated_at":"2025-11-04T19:53:44.849134754+01:00","closed_at":"2025-11-04T19:53:44.849134754+01:00","source_repo":"."}
{"id":"ptnextjs-897c","content_hash":"3abfd1a4fd3be8ff5f379294bbb16f32c303f0f17432d93854b9448ce06a4be8","title":"Add Tier Downgrade Request Workflow","description":"## Overview\nExtend tier request system to support vendor-initiated tier downgrade requests with admin approval.\n\n## Context\nUnlike upgrades which are generally straightforward, downgrades require careful handling:\n- Data retention concerns (what happens to tier-locked content?)\n- Feature access revocation\n- Existing data migration/archival\n- Potential cancellation flow integration\n\n## Requirements\n\n### Database Schema Extension\nExtend `tier_upgrade_requests` to support downgrades:\n- Rename to `tier_change_requests` (or keep current name but support both)\n- Add `changeType` field: 'upgrade' | 'downgrade'\n- Add `dataRetentionOption` field:\n  - 'archive' - Archive tier-locked content, restore on re-upgrade\n  - 'delete' - Permanently delete tier-locked content\n  - 'downgrade_features_only' - Keep data but disable features\n\n### Vendor API Endpoints\n- `POST /api/portal/vendors/[id]/tier-downgrade-request`\n  - Submit downgrade request\n  - Require downgrade reason from vendor\n  - Present data retention options\n  - Validate requested tier is lower than current\n\n### Admin Review\n- Admin sees downgrade requests separately or with type indicator\n- Admin must explicitly acknowledge data implications\n- Admin can add notes about data handling\n\n### Data Migration Service\n- Create `TierDowngradeService` to handle:\n  - Identify tier-locked data (locations, team members, etc.)\n  - Archive or delete based on vendor selection\n  - Create migration report\n  - Log all data changes for audit\n\n### Business Rules\n1. **Location Limits:**\n   - Tier3→Tier2: Keep up to 10 locations\n   - Tier2→Tier1: Keep up to 1 location\n   - Tier1→Free: Remove all locations\n   - Vendor chooses which to keep (if applicable)\n\n2. **Team Members:**\n   - Tier1→Free: Archive team member profiles\n\n3. **Promotions:**\n   - Tier3→lower: Deactivate active promotions\n\n4. **Content:**\n   - Case studies, certifications: Archive or keep (TBD)\n\n### UI Components\n- `TierDowngradeRequestForm` with:\n  - Downgrade reason textarea (required)\n  - Data retention options\n  - Clear warnings about feature loss\n  - Confirmation checkboxes\n- Admin review shows:\n  - Downgrade reason\n  - Data retention choice\n  - Impact summary (X locations, Y team members, etc.)\n\n## Acceptance Criteria\n- [ ] Database schema supports downgrades\n- [ ] Vendor can request downgrade with reason\n- [ ] Vendor selects data retention option\n- [ ] Admin can approve/reject downgrade requests\n- [ ] TierDowngradeService migrates/archives data\n- [ ] Tier-locked data handled per vendor selection\n- [ ] Audit log of all data changes\n- [ ] Clear UI warnings about feature loss\n- [ ] Edge cases handled (e.g., active promotions)\n- [ ] Rollback capability if downgrade fails\n\n## Open Questions\n1. Should downgrades be instant or scheduled (end of billing period)?\n2. How long should archived data be retained?\n3. Should vendors be able to restore archived data on re-upgrade?\n4. What's the grace period for data deletion?","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-04T14:06:12.963743963+01:00","updated_at":"2025-11-04T14:06:12.963743963+01:00","source_repo":".","labels":["api","backend","tier-management"],"dependencies":[{"issue_id":"ptnextjs-897c","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:06:12.985283953+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-8df5","content_hash":"087dc9932274f301e714e760b63ed3b09706197e8b683ec6898c9f08d0293a12","title":"Implement Admin Panel Tier Upgrade Request Management UI","description":"## Overview\nCreate admin panel UI for managing vendor tier upgrade requests.\n\n## Current State\n- ✅ Admin panel exists at `/admin` (Payload CMS)\n- ✅ Admin can change tiers via API: `PUT /api/admin/vendors/[id]/tier`\n- ❌ No admin UI for viewing upgrade requests\n- ❌ No approval/rejection workflow UI\n- ❌ No upgrade request queue\n\n## Implementation Decision Required\n\n**Option A: Payload CMS Custom Collection View (RECOMMENDED)**\n- Add `tier_upgrade_requests` as Payload collection\n- Use Payload's built-in admin UI for list/detail views\n- Add custom cell components for status badges\n- Add custom actions for approve/reject buttons\n- Pros: Integrates seamlessly with existing /admin, leverages Payload's UI\n- Cons: Limited to Payload's UI patterns\n\n**Option B: Separate Admin Portal Page**\n- Create `app/(site)/admin-portal/tier-requests/page.tsx`\n- Build custom UI with full control\n- Separate from Payload admin\n- Pros: Full UI flexibility, custom workflows\n- Cons: Separate auth, doesn't leverage Payload admin\n\n**RECOMMENDATION: Option A** - Use Payload's admin UI with custom components\n\n## Requirements (Option A - Payload Admin)\n\n### Payload Collection Configuration\nIn `payload/collections/TierUpgradeRequests.ts`:\n- Enable admin UI with custom components\n- Add custom cell for status badge\n- Add custom actions for approve/reject\n- Configure list view with filters\n\n### Custom Components\n1. **StatusBadgeCell** (`payload/components/StatusBadgeCell.tsx`)\n   - Custom cell component for status column\n   - Color-coded badges (pending=yellow, approved=green, rejected=red)\n\n2. **ApproveRejectActions** (`payload/components/ApproveRejectActions.tsx`)\n   - Custom action buttons in row/detail view\n   - Approve button with confirmation\n   - Reject button with reason modal\n   - Only show if status=pending\n\n3. **TierChangePreview** (`payload/components/TierChangePreview.tsx`)\n   - Shows current tier → requested tier\n   - Vendor information summary\n   - Request notes from vendor\n\n### Admin Workflows\n1. **View Requests:**\n   - Admin logs into /admin\n   - Navigates to \"Tier Upgrade Requests\" collection\n   - Sees list with columns: Vendor, Current, Requested, Status, Date, Actions\n   - Can filter by status (pending/approved/rejected)\n   - Can sort by date, vendor name\n\n2. **Approve Request:**\n   - Click \"Approve\" button on pending request\n   - Confirmation modal shows tier change details\n   - Admin confirms\n   - API call to approve endpoint\n   - Vendor tier updated\n   - Success toast shown\n   - Request status updates to approved\n\n3. **Reject Request:**\n   - Click \"Reject\" button on pending request\n   - Modal prompts for rejection reason (required)\n   - Admin enters reason and confirms\n   - API call to reject endpoint\n   - Request status updates to rejected\n   - Success toast shown\n   - Vendor can see rejection reason\n\n## Alternative Approach (If Option B chosen)\nCreate standalone pages:\n- `app/(site)/admin-portal/tier-requests/page.tsx` - List view\n- `app/(site)/admin-portal/tier-requests/[id]/page.tsx` - Detail view\n- Components: TierUpgradeRequestsList, TierUpgradeRequestModal, etc.\n\n## API Integration\n- GET /api/admin/tier-upgrade-requests - List with filters\n- PUT /api/admin/tier-upgrade-requests/[id]/approve - Approve\n- PUT /api/admin/tier-upgrade-requests/[id]/reject - Reject\n\n## Acceptance Criteria\n- [ ] Decide on implementation approach (Option A vs B)\n- [ ] TierUpgradeRequests collection configured in Payload admin\n- [ ] Custom status badge cell component\n- [ ] Custom approve/reject action components\n- [ ] List view shows all requests with filtering\n- [ ] Detail view shows full request information\n- [ ] Approve action updates tier and request status\n- [ ] Reject action requires reason and stores it\n- [ ] Only pending requests show approve/reject actions\n- [ ] Admin sees vendor details (company, email, current tier)\n- [ ] Toast notifications for success/error\n- [ ] Proper error handling\n- [ ] Admin-only access (auth check)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-04T14:04:28.609286967+01:00","updated_at":"2025-11-04T14:16:51.045800408+01:00","source_repo":".","labels":["admin","frontend","ui"],"dependencies":[{"issue_id":"ptnextjs-8df5","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:04:28.626894284+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-9505","content_hash":"4aef57ab8f82cba3e3c8813e5015244911e26d0a64ddd91650cf8c5d139b618a","title":"Implement Admin Tier Upgrade API Endpoint","description":"Create PUT /api/admin/vendors/[id]/tier endpoint to upgrade vendor tiers without payment. Required for testing tier1/tier2/tier3 features.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-03T09:14:48.317155781+01:00","updated_at":"2025-11-03T09:32:33.824008265+01:00","closed_at":"2025-11-03T09:32:33.824008265+01:00","source_repo":".","labels":["api","backend","e2e","testing"]}
{"id":"ptnextjs-9678","content_hash":"661f6e4fe1d6268821944fad2fe074bc1ba5acd37ae0435b7116cb10b4da3186","title":"impl-admin-actions: Implement Admin Approve/Reject UI Components","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.872202103+01:00","updated_at":"2025-11-05T08:03:48.749949067+01:00","closed_at":"2025-11-05T08:03:48.749949067+01:00","source_repo":"."}
{"id":"ptnextjs-96a9","content_hash":"70ac2a169944c534c1b9ceaf945cfb9c51dd95d6ddaf75cddda6c5b88157f425","title":"pre-1: Perform Codebase Analysis","description":"Codebase analysis for tier upgrade request system. Agent: context-fetcher. Time: 3-5 min. See .agent-os/specs/2025-11-04-tier-upgrade-request-system/tasks/task-pre-1.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-04T15:43:48.505371576+01:00","updated_at":"2025-11-04T19:53:44.841266834+01:00","closed_at":"2025-11-04T19:53:44.841266834+01:00","source_repo":".","labels":["pre-execution","tier-upgrade"]}
{"id":"ptnextjs-a114","content_hash":"1f69890ad5851f14d2a5dd4ff1f0da6323953b7396a27fb697e591abc8acd1b8","title":"Implement or fix product management UI route","description":"Test 9.2 expects /vendor/dashboard/products route but may not exist or may be integrated into profile tabs. Need to either create route or update tests to match current architecture. Affects Tests 9.2-9.6","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-03T13:57:19.31770536+01:00","updated_at":"2025-11-03T19:06:38.908891033+01:00","closed_at":"2025-11-03T19:06:38.908891033+01:00","source_repo":".","labels":["product-management","routing","ui"]}
{"id":"ptnextjs-ac78","content_hash":"69904a1346b6a429725f5b9fed00874845d720a44a07cb999e83ad093b4bc3b2","title":"Final QA validation and integration testing","description":"Comprehensive pre-merge validation: 1) Run full test suite (npm test \u0026\u0026 npm run test:e2e), 2) TypeScript compilation check, 3) Production build verification, 4) Manual QA of critical workflows (vendor submit request, admin approve/reject, cancel), 5) Browser testing (Chrome, Firefox, Safari), 6) Mobile responsiveness check","acceptance_criteria":"All tests pass, build succeeds, manual QA complete, no regressions, ready for merge","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T09:48:30.908646195+01:00","updated_at":"2025-11-06T10:11:19.277298386+01:00","closed_at":"2025-11-06T10:11:19.277301703+01:00","source_repo":".","labels":["pre-merge","qa","tier-upgrade-system","validation"],"dependencies":[{"issue_id":"ptnextjs-ac78","depends_on_id":"ptnextjs-c810","type":"blocks","created_at":"2025-11-06T09:48:30.916860568+01:00","created_by":"edwin"},{"issue_id":"ptnextjs-ac78","depends_on_id":"ptnextjs-522d","type":"blocks","created_at":"2025-11-06T09:48:30.918500188+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-b439","content_hash":"2cde97841c4c92b73dcd87c53849c945cc20c284ea122c34d61339ffbaa8d948","title":"E2E Test Suite 01: Vendor Registration","description":"Implement 8 test scenarios for vendor registration flow. File: tests/e2e/vendor-onboarding/01-registration.spec.ts","acceptance_criteria":"✓ Test 1.1: Successful registration with all fields\n✓ Test 1.2: Validation errors for missing fields\n✓ Test 1.3: Invalid email format validation\n✓ Test 1.4: Password mismatch validation\n✓ Test 1.5: Weak password rejection\n✓ Test 1.6: Duplicate email detection\n✓ Test 1.7: Submit button disabled during submission\n✓ Test 1.8: Terms and conditions acceptance\n✓ Uses helper functions (no duplicated code)\n✓ Captures screenshots on failure\n✓ Execution time \u003c 5 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:15:14.318244264+01:00","updated_at":"2025-11-03T09:49:32.603047413+01:00","closed_at":"2025-11-03T09:49:32.603047413+01:00","source_repo":".","labels":["e2e","smoke-test","testing"]}
{"id":"ptnextjs-b44c","content_hash":"5a3fefcf4a709befe0dbf3603fdd476f1d98674d160a2f3dfb5a4e9c73466f90","title":"impl-backend-types: Implement TypeScript Type Definitions","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.854236807+01:00","updated_at":"2025-11-04T19:53:44.847861921+01:00","closed_at":"2025-11-04T19:53:44.847861921+01:00","source_repo":"."}
{"id":"ptnextjs-b85d","content_hash":"fee3931c8667317346a1e451ecdec7b92946a10ad28db48e46b3809a0ad4cdb4","title":"E2E Test Suite 09: Product Management","description":"Implement 7 test scenarios for product CRUD. File: tests/e2e/vendor-onboarding/09-product-management.spec.ts","acceptance_criteria":"✓ Test 9.1: Access product management (tier 2+ only)\n✓ Test 9.2: View product list for vendor\n✓ Test 9.3: Add new product with all fields\n✓ Test 9.4: Edit existing product details\n✓ Test 9.5: Delete product with confirmation\n✓ Test 9.6: Publish/unpublish product toggle\n✓ Test 9.7: Product categories assignment (multi-select)\n✓ Product CRUD operations working\n✓ Tier 2+ restriction enforced\n✓ All 7 tests passing\n✓ Execution time \u003c 5 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:24.602009309+01:00","updated_at":"2025-11-03T12:36:25.799972555+01:00","closed_at":"2025-11-03T12:36:25.799972555+01:00","source_repo":".","labels":["advanced-features","e2e","testing"],"dependencies":[{"issue_id":"ptnextjs-b85d","depends_on_id":"ptnextjs-f9d4","type":"blocks","created_at":"2025-11-03T09:15:24.610051175+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-ba45","content_hash":"0cecf0ab048d80e45a8cf25f887340527321ff2c15c7566fe62d7ef1a4c867f6","title":"Excel Vendor Import/Export Feature","description":"Complete Excel-based vendor data import/export system with tier-based templates, validation, and atomic imports. Enables vendors to bulk upload/update company info, products, and locations. Spec: .agent-os/specs/2025-11-06-excel-vendor-import-export/","notes":"VAL-1: Security Validation COMPLETED - Fixed all npm vulnerabilities (0 remaining) - Created comprehensive security test suite (12 tests) - Generated security validation report - Verified all OWASP Top 10 mitigations - Zero critical/high vulnerabilities found. Remaining: VAL-2 Performance, VAL-3 Browser Testing, VAL-4 Documentation, VAL-5 Acceptance Verification. Status: 29/32 tasks complete (91%)","status":"in_progress","priority":0,"issue_type":"epic","created_at":"2025-11-06T22:00:31.515411181+01:00","updated_at":"2025-11-07T19:16:16.429698621+01:00","source_repo":".","labels":["backend","critical-path","excel-import-export","frontend"]}
{"id":"ptnextjs-bbe0","content_hash":"f9066fe04d9efa200e1ca9b71a13ecb95530734eec544a0c50df1865891cb9b3","title":"Clean up ESLint warnings in dashboard components","description":"Remove unused imports and variables from dashboard components: BrandStoryForm.tsx, CaseStudiesManager.tsx, CertificationsAwardsManager.tsx, DashboardSidebar.tsx, ProfileEditTabs.tsx, PromotionPackForm.tsx, TeamMembersManager.tsx, vendors-client.tsx. Fix unescaped entities. Target: 0 ESLint errors (warnings acceptable)","acceptance_criteria":"All ESLint errors resolved, unused imports removed, unescaped entities fixed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T09:48:29.268255322+01:00","updated_at":"2025-11-06T10:11:09.456685907+01:00","closed_at":"2025-11-06T10:11:09.456688773+01:00","source_repo":".","labels":["cleanup","code-quality","dashboard"]}
{"id":"ptnextjs-bbec","content_hash":"dea57592988b2a1a27a001d54ae2622554bd2f5773ab614eb204913bb06f678c","title":"Implement Vendor Tier Upgrade Request System","description":"## Overview\nImplement a complete vendor-initiated tier upgrade request system that allows vendors to request tier upgrades and admins to approve/reject them.\n\n## Current State\n- ✅ Admin can directly change tiers via `PUT /api/admin/vendors/[id]/tier`\n- ✅ UI components exist: `TierUpgradePrompt`, `UpgradePromptCard`, `SubscriptionTierBadge`\n- ❌ No vendor request submission workflow\n- ❌ No admin approval queue/workflow\n- ❌ No request tracking collection in database\n- ❌ Current flow: Vendor → \"Contact Sales\" mailto link → Manual process\n\n## Requirements\n\n### Database Schema\n- Create `tier_upgrade_requests` collection in Payload CMS with fields:\n  - `id` (primary key)\n  - `vendor` (relationship to vendors collection)\n  - `user` (relationship to users collection)\n  - `currentTier` (free|tier1|tier2|tier3)\n  - `requestedTier` (tier1|tier2|tier3)\n  - `status` (pending|approved|rejected|cancelled)\n  - `requestedAt` (timestamp)\n  - `reviewedAt` (timestamp, nullable)\n  - `reviewedBy` (relationship to users, nullable)\n  - `rejectionReason` (richText, nullable)\n  - `notes` (richText, nullable)\n  - `vendorNotes` (text - why vendor wants upgrade)\n\n### Vendor API Endpoints\n- `POST /api/portal/vendors/[id]/tier-upgrade-request`\n  - Submit upgrade request with vendor notes\n  - Validate: no pending request exists\n  - Validate: requested tier is higher than current\n  - Return request ID and status\n- `GET /api/portal/vendors/[id]/tier-upgrade-request`\n  - Get current/recent upgrade request status\n  - Include rejection reason if rejected\n- `DELETE /api/portal/vendors/[id]/tier-upgrade-request/[requestId]`\n  - Cancel pending request (must be status=pending)\n\n### Admin API Endpoints\n- `GET /api/admin/tier-upgrade-requests`\n  - List all upgrade requests with filters (status, vendor, date range)\n  - Include vendor details (companyName, email, currentTier)\n  - Support pagination and sorting\n- `PUT /api/admin/tier-upgrade-requests/[id]/approve`\n  - Approve request and update vendor tier atomically\n  - Log tier change with admin user ID\n  - Set reviewedAt timestamp\n- `PUT /api/admin/tier-upgrade-requests/[id]/reject`\n  - Reject request with reason (required)\n  - Do NOT update vendor tier\n  - Notify vendor (if notification system available)\n\n## Integration Points\n- Reuse existing `PUT /api/admin/vendors/[id]/tier` for the actual tier update on approval\n- Update existing `UpgradePromptCard` to link to new subscription page\n- Update dashboard upgrade buttons to navigate to request form\n\n## Acceptance Criteria\n- [ ] `tier_upgrade_requests` collection created in `payload.config.ts`\n- [ ] Collection file created: `payload/collections/TierUpgradeRequests.ts`\n- [ ] Vendor can submit tier upgrade request with notes\n- [ ] Vendor can view their request status\n- [ ] Vendor can cancel pending request\n- [ ] Admin can list all upgrade requests with filters\n- [ ] Admin can approve requests (updates vendor tier atomically)\n- [ ] Admin can reject requests with reason\n- [ ] No duplicate pending requests allowed per vendor\n- [ ] Cannot request downgrade (validation enforced)\n- [ ] All endpoints have proper auth/authorization\n- [ ] Request lifecycle properly tracked (timestamps, status changes)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-04T14:03:51.461747689+01:00","updated_at":"2025-11-08T10:22:34.176966768+01:00","closed_at":"2025-11-08T10:22:34.176966768+01:00","source_repo":".","labels":["api","backend","database"]}
{"id":"ptnextjs-bc46","content_hash":"389c3650cdd0fad8a2d9a3c26cbc9eeafb1b7c399631cc364f8b6ea5ad5b3da0","title":"Implement Notification System for Tier Upgrade Requests","description":"## Overview\nImplement notification system to inform vendors and admins about tier upgrade request status changes.\n\n## Requirements\n\n### Notification Types\n\n**For Vendors:**\n1. **Request Submitted** - Confirmation that request was received\n2. **Request Approved** - Tier upgrade approved, features unlocked\n3. **Request Rejected** - Request rejected with admin's reason\n4. **Request Cancelled** - Confirmation of cancellation\n\n**For Admins:**\n1. **New Request Received** - New vendor upgrade request pending review\n2. **Request Cancelled** - Vendor cancelled their request\n\n### Notification Channels\n\n**Phase 1 (MVP):**\n- In-app notifications (dashboard bell icon)\n- Email notifications\n\n**Phase 2 (Future):**\n- SMS notifications (optional)\n- Webhook/Slack integration for admins\n\n### Implementation\n\n**Database Schema:**\n- Create `notifications` collection/table:\n  - `id` (primary key)\n  - `userId` (recipient)\n  - `type` (upgrade_request_submitted|approved|rejected|cancelled|new_request)\n  - `title` (notification title)\n  - `message` (notification body)\n  - `read` (boolean)\n  - `metadata` (JSON - request details, vendor info, etc.)\n  - `createdAt` (timestamp)\n\n**Email Templates:**\n- Create email templates in `emails/` directory:\n  - `tier-upgrade-request-submitted.tsx` (vendor)\n  - `tier-upgrade-request-approved.tsx` (vendor)\n  - `tier-upgrade-request-rejected.tsx` (vendor)\n  - `tier-upgrade-request-new.tsx` (admin)\n\n**API Endpoints:**\n- `GET /api/notifications` - Get user's notifications\n- `PUT /api/notifications/[id]/read` - Mark as read\n- `PUT /api/notifications/mark-all-read` - Mark all as read\n- `DELETE /api/notifications/[id]` - Delete notification\n\n**Service Layer:**\n- Create `NotificationService` in `lib/services/`\n  - `createNotification(userId, type, data)`\n  - `sendEmail(userId, template, data)`\n  - `getUserNotifications(userId, filters)`\n  - `markAsRead(notificationId)`\n\n**UI Components:**\n- `NotificationBell` - Header bell icon with unread count\n- `NotificationDropdown` - Dropdown list of recent notifications\n- `NotificationCenter` - Full page view of all notifications\n- `NotificationItem` - Individual notification card\n\n### Triggers\n\nNotifications should be triggered:\n1. When vendor submits request → notify admins\n2. When admin approves → notify vendor\n3. When admin rejects → notify vendor\n4. When vendor cancels → notify admins (optional)\n\n## Acceptance Criteria\n- [ ] Database schema for notifications created\n- [ ] Email templates created for all notification types\n- [ ] NotificationService implemented\n- [ ] Notification API endpoints created\n- [ ] Notifications triggered on tier request events\n- [ ] Email sending integrated (Resend, SendGrid, or similar)\n- [ ] In-app notification UI components created\n- [ ] Notification bell icon shows unread count\n- [ ] Notifications can be marked as read\n- [ ] Email preferences (allow opt-out)\n- [ ] Proper error handling for failed emails\n- [ ] Rate limiting on notification sending","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-04T14:05:46.094788558+01:00","updated_at":"2025-11-04T14:05:46.094788558+01:00","source_repo":".","labels":["backend","enhancement","notifications"],"dependencies":[{"issue_id":"ptnextjs-bc46","depends_on_id":"ptnextjs-bbec","type":"blocks","created_at":"2025-11-04T14:05:46.107769024+01:00","created_by":"edwin"}]}
{"id":"ptnextjs-bd2d","content_hash":"506d57932173013d98559ba6292ebe39522972a2dc3c4a3ce548ff77ee9e9986","title":"Fix Test 6.9: Reduce description length to respect 500 char limit","description":"Test 6.9 fills 562-char description but form validates max 500 chars. Need to change test to use 450-char description. File: tests/e2e/vendor-onboarding/06-tier1-advanced-profile.spec.ts line ~460","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T13:57:16.829136433+01:00","updated_at":"2025-11-03T18:59:05.592952085+01:00","closed_at":"2025-11-03T18:59:05.592952085+01:00","source_repo":".","labels":["testing","validation"]}
{"id":"ptnextjs-bd61","content_hash":"65deb8409ff0b19206b260ed0d4a055a160c7e9dde4bb4c38d8d459087514ce9","title":"E2E Test Suite 11: Security \u0026 Access Control","description":"Implement 6 test scenarios for security (auth, XSS, CSRF, rate limiting). File: tests/e2e/vendor-onboarding/11-security-access-control.spec.ts","acceptance_criteria":"✓ Test 11.1: Vendor cannot access another vendor's dashboard (403)\n✓ Test 11.2: API rejects tier-restricted fields from lower tier vendors\n✓ Test 11.3: API prevents vendor from updating another vendor\n✓ Test 11.4: XSS prevention - script injection sanitized\n✓ Test 11.5: CSRF protection enforced on mutations\n✓ Test 11.6: Rate limiting prevents abuse (429 after threshold)\n✓ Verifies authorization checks\n✓ Tests XSS/CSRF protection mechanisms\n✓ Security vulnerabilities addressed\n✓ All 6 security tests passing\n✓ Execution time \u003c 6 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:15:27.284166815+01:00","updated_at":"2025-11-03T10:49:46.943775907+01:00","closed_at":"2025-11-03T10:49:46.943775907+01:00","source_repo":".","labels":["e2e","security","testing"]}
{"id":"ptnextjs-bd78","content_hash":"85a57806b30a996390992b0c174c3fdd247b5123ddce595eaeb967e7733b5f79","title":"BE-4: Create ExcelParserService - NEXT TASK","description":"Parse uploaded Excel files into structured data. Parse 3 sheets (Company Info, Products, Locations), convert cell values to proper types, resolve relationships (category names to IDs), sanitize formula injection. Critical path task for import functionality.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-06T22:00:18.249209392+01:00","updated_at":"2025-11-06T22:08:22.17383224+01:00","closed_at":"2025-11-06T22:08:22.17383224+01:00","source_repo":".","labels":["backend","excel-import-export","next-session","services"]}
{"id":"ptnextjs-bd89","content_hash":"dbb05a3dba729e20b1585508a6be885c1ef0b30367dab894d7b3247bf1de5ac9","title":"impl-backend-collection: Implement TierUpgradeRequests Payload Collection","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.852698739+01:00","updated_at":"2025-11-04T19:53:44.846547599+01:00","closed_at":"2025-11-04T19:53:44.846547599+01:00","source_repo":"."}
{"id":"ptnextjs-c141","content_hash":"69e04a1c3454838f87348aac0d884a4dc89e97ce691b00af2b3deb81ad28ff09","title":"test-backend-admin-api: Design Admin API Endpoint Tests","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.860775815+01:00","updated_at":"2025-11-04T19:54:03.824308174+01:00","closed_at":"2025-11-04T19:54:03.824308174+01:00","source_repo":"."}
{"id":"ptnextjs-c369","content_hash":"38658c645ccb21d9050023cfc0454bc62e720e505f467d69f51654d68542c99d","title":"Fix test framework mismatches","description":"file-upload-integration.test.tsx: Convert from Vitest to Jest. full-stack-locations.test.ts: Move Playwright E2E test to tests/e2e/ directory.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-07T22:27:40.296621079+01:00","updated_at":"2025-11-08T07:21:53.352390458+01:00","closed_at":"2025-11-08T07:21:53.352390458+01:00","source_repo":".","labels":["cleanup","configuration","testing"]}
{"id":"ptnextjs-c810","content_hash":"f8371d88e3d03f5cfabe5d470018df3f19a5110ca5748b6657a28cb2707ace9b","title":"Fix remaining 5 tier-upgrade unit test failures","description":"Fix tier-specific unit test failures identified in validation report. Tests: TierUpgradeRequests.test.ts tier validation, UpgradeRequestStatusCard.test.tsx reviewer display, async timing issues. Files: __tests__/payload/collections/TierUpgradeRequests.test.ts, components/dashboard/__tests__/*.test.tsx","acceptance_criteria":"All tier-upgrade specific tests pass, no async timing issues, test coverage 85%+","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T09:47:50.761999003+01:00","updated_at":"2025-11-06T10:11:06.179319438+01:00","closed_at":"2025-11-06T10:11:06.179323109+01:00","source_repo":".","labels":["pre-merge","testing","tier-upgrade-system"]}
{"id":"ptnextjs-ca78","content_hash":"250302855ccbe818db85413b9dde7b5bef9a4c54d1bbf1e0a2835bbc616cfe45","title":"impl-backend-vendor-api: Implement Vendor Portal API Endpoints","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.859517222+01:00","updated_at":"2025-11-04T19:53:44.853740431+01:00","closed_at":"2025-11-04T19:53:44.853740431+01:00","source_repo":"."}
{"id":"ptnextjs-cad0","content_hash":"86dea7dd92a47b736b8498cb6ab4d950048fd36445e481c56ca303f94a71aaea","title":"Fix component rendering tests (7 test files, ~24 failing tests)","description":"ProfileEditTabs: 8 failures - tab count mismatches, lock icon rendering. OwnerReviews: 8 failures - Dialog ARIA, mock callbacks. PerformanceMetrics: 6 failures - duplicate testids. VisualDemo: 6 failures - missing testids, click handlers. TierGate/GeocodingButton: Missing hooks/services.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-07T22:27:37.855378893+01:00","updated_at":"2025-11-08T07:21:57.91672924+01:00","closed_at":"2025-11-08T07:21:57.91672924+01:00","source_repo":".","labels":["components","testing","ui"]}
{"id":"ptnextjs-d68d","content_hash":"da20bcfef80721fa3125cfae9af021fb079d5d20a0aa87a34d35cde92df7c10d","title":"valid-security: Security Validation","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.878841582+01:00","updated_at":"2025-11-06T08:57:32.736789747+01:00","closed_at":"2025-11-06T08:57:32.736789747+01:00","source_repo":"."}
{"id":"ptnextjs-d777","content_hash":"850672b0a01b81750019995fc95bfe2e2a69d24c38ce535fb48d2b0789249a71","title":"E2E Test Suite 08: Tier 3 Promotions","description":"Implement 5 test scenarios for tier 3 promotion features. File: tests/e2e/vendor-onboarding/08-tier3-promotions.spec.ts","acceptance_criteria":"✓ Test 8.1: Access promotion pack tab (tier 3 only)\n✓ Test 8.2: Featured placement toggle functionality\n✓ Test 8.3: Editorial content display (read-only)\n✓ Test 8.4: Tier 3 enterprise badge display on profile\n✓ Test 8.5: Unlimited locations allowed (\u003e10)\n✓ Verifies tier 3 exclusive features\n✓ Tests featured vendor functionality\n✓ Contact sales CTA visible\n✓ All 5 tests passing\n✓ Execution time \u003c 4 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:23.339422647+01:00","updated_at":"2025-11-03T12:29:37.457048427+01:00","closed_at":"2025-11-03T12:29:37.457048427+01:00","source_repo":".","labels":["advanced-features","e2e","testing"]}
{"id":"ptnextjs-d8c8","content_hash":"7868c39771a8c9ab6800fbf9dfa939961a7e47bebb7d944fbfe2e8b957e25228","title":"Configure CI/CD Pipeline for E2E Tests","description":"Set up GitHub Actions workflow for automated E2E test execution on PRs. File: .github/workflows/e2e-vendor-onboarding.yml","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-03T09:15:29.805496722+01:00","updated_at":"2025-11-03T19:04:23.162634335+01:00","source_repo":".","labels":["automation","ci-cd","testing"]}
{"id":"ptnextjs-db7e","content_hash":"c655a4f0b33b287e7ea38acc06b4602cb2e767539611c972f53f128360bc2d09","title":"Implement Admin Authentication for E2E Tests","description":"Admin API endpoints (approve, reject, tier upgrade) return 401 unauthorized when called from tests. Tests 2.2 and 2.5 in Suite 02 currently expect this behavior. Need to either: 1) Implement admin login flow in tests, 2) Add test mode bypass for admin APIs, or 3) Update tests to gracefully handle 401 responses. Current workaround: tests check for [200, 401, 403] status codes.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T10:56:27.122690328+01:00","updated_at":"2025-11-03T19:07:36.594465046+01:00","closed_at":"2025-11-03T19:07:36.594465046+01:00","source_repo":".","labels":["admin","auth","e2e"]}
{"id":"ptnextjs-e0a1","content_hash":"cf9bd7dcd482df6c4b98fc9d02f28e9e99a3decdfb91adc37680425c423b6081","title":"final-validation: Final Quality Validation","description":"Priority: 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.884546754+01:00","updated_at":"2025-11-06T08:57:37.199658055+01:00","closed_at":"2025-11-06T08:57:37.199658055+01:00","source_repo":"."}
{"id":"ptnextjs-e0b6","content_hash":"5e4ba321d252f8501484a5c4a888f218a14600c0a2570ff13e7a02c113d7dfff","title":"impl-frontend-comparison: Implement TierComparisonTable Component","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.864897809+01:00","updated_at":"2025-11-04T21:07:15.976686876+01:00","closed_at":"2025-11-04T21:07:15.976686876+01:00","source_repo":"."}
{"id":"ptnextjs-e8de","content_hash":"d4dadf6597dba54edccf05fd6e13b787db786e397f4104112d8a6d8a8cf992ce","title":"E2E Test Suite 06: Tier 1 Advanced Profile","description":"Implement 9 test scenarios for tier 1 features (certifications, awards, team, case studies). File: tests/e2e/vendor-onboarding/06-tier1-advanced-profile.spec.ts","acceptance_criteria":"✓ Test 6.1: Fill brand story (website, social links, founded year)\n✓ Test 6.2: Add certification (ISO 9001)\n✓ Test 6.3: Edit existing certification\n✓ Test 6.4: Delete certification with confirmation\n✓ Test 6.5: Add award with details\n✓ Test 6.6: Add case study with full details\n✓ Test 6.7: Add team member with photo\n✓ Test 6.8: Reorder team members via drag-and-drop\n✓ Test 6.9: Add long company description (rich text)\n✓ Tests all tier 1 features\n✓ Verifies years in business computation\n✓ CRUD operations working for all entities\n✓ All 9 tests passing\n✓ Execution time \u003c 6 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:20.859813226+01:00","updated_at":"2025-11-03T12:27:20.485983611+01:00","closed_at":"2025-11-03T12:27:20.485983611+01:00","source_repo":".","labels":["advanced-features","e2e","testing"]}
{"id":"ptnextjs-eea7","content_hash":"82fd04b74531e3f9125dc49f60d7c14cc08c3e685cda95889de10cba688d763a","title":"health-3: Create /api/health/ready Database Check","description":"Create readiness endpoint with database connectivity check","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T17:08:00.001722445+01:00","updated_at":"2025-11-06T17:10:11.354433095+01:00","closed_at":"2025-11-06T17:10:11.354433095+01:00","source_repo":".","labels":["docker","health-check"]}
{"id":"ptnextjs-f10d","content_hash":"33fe5871df5034b5ac99e3ab1c6ee19c44f8a116db77f49ab0a989f74821958f","title":"E2E Test Suite 10: Public Profile Display","description":"Implement 6 test scenarios for tier-specific public profile display. File: tests/e2e/vendor-onboarding/10-public-profile-display.spec.ts","acceptance_criteria":"✓ Test 10.1: Free tier public profile shows basic info only\n✓ Test 10.2: Tier 1 public profile shows enhanced features\n✓ Test 10.3: Tier 2 public profile shows locations map\n✓ Test 10.4: Tier 3 public profile shows featured badge\n✓ Test 10.5: Responsive design works on mobile (375px viewport)\n✓ Test 10.6: SEO metadata present (title, description, OG tags)\n✓ Verifies tier-specific visibility\n✓ Tests responsive layout (mobile, tablet, desktop)\n✓ Validates computed fields (years in business)\n✓ All 6 tests passing\n✓ Execution time \u003c 4 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:25.972140863+01:00","updated_at":"2025-11-03T12:35:20.65642041+01:00","closed_at":"2025-11-03T12:35:20.65642041+01:00","source_repo":".","labels":["e2e","public-facing","testing"]}
{"id":"ptnextjs-f18f","content_hash":"b8e872d7a2f33c5cfd66b75ec4dd52c7e318ea6271bdcc20e85a24adea597517","title":"test-frontend-components: Design Frontend Component Tests","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.863563133+01:00","updated_at":"2025-11-04T20:52:03.528889221+01:00","closed_at":"2025-11-04T20:52:03.528889221+01:00","source_repo":"."}
{"id":"ptnextjs-f248","content_hash":"d129f2b3e9ad473f0681f71265c810f50d45ef55e4b4903604ef8298ba111460","title":"Implement Test Vendor Seed API Endpoint","description":"Create POST /api/test/vendors/seed endpoint for bulk vendor creation. Speeds up E2E tests by 10x. NODE_ENV guard required.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:14:49.648685746+01:00","updated_at":"2025-11-03T09:43:54.364112728+01:00","closed_at":"2025-11-03T09:43:54.364112728+01:00","source_repo":".","labels":["api","backend","performance","testing"]}
{"id":"ptnextjs-f617","content_hash":"99d3b63b7dc249c629bcdef386f0b5a00091aadf63de4ff777090cfb991d339b","title":"Fix vendor seed API locations handling","description":"The seed API at app/api/test/vendors/seed/route.ts (lines 141-153) is incorrectly trying to create locations in a non-existent 'vendor-locations' collection. Locations are stored as an array field in the Vendors collection. Fix: Include locations array directly in vendor creation data instead of creating separate documents.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-03T15:21:04.772034231+01:00","updated_at":"2025-11-03T15:22:16.386137426+01:00","closed_at":"2025-11-03T15:22:16.386137426+01:00","source_repo":".","labels":["api","backend","database","seed"]}
{"id":"ptnextjs-f7ab","content_hash":"41396c7c5c886ca0eb5b5bf5d6419b036d19b5a87dfa2b874b6c8b807a851b79","title":"impl-backend-service: Implement TierUpgradeRequestService","description":"Priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.85688602+01:00","updated_at":"2025-11-04T19:53:44.85042997+01:00","closed_at":"2025-11-04T19:53:44.85042997+01:00","source_repo":"."}
{"id":"ptnextjs-f9d4","content_hash":"bddae934760ac42bb43cd8624de62772494473f805a1b365a0100fd393436202","title":"Implement Test Product Seed API Endpoint","description":"Create POST /api/test/products/seed endpoint for bulk product creation. Required for product management tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-03T09:14:51.091805062+01:00","updated_at":"2025-11-03T09:43:54.366923149+01:00","closed_at":"2025-11-03T09:43:54.366923149+01:00","source_repo":".","labels":["api","backend","testing"]}
{"id":"ptnextjs-fdf2","content_hash":"663b1c799447143ef9cf7ca159befab6b0bba7ec4a258263e0c0fe65e4cd2fe2","title":"E2E Test Suite 12: End-to-End Happy Path","description":"Implement complete vendor journey test from registration to tier 3. File: tests/e2e/vendor-onboarding/12-e2e-happy-path.spec.ts","acceptance_criteria":"✓ Step 1: Complete registration flow\n✓ Step 2: Admin approval process\n✓ Step 3: First login to dashboard\n✓ Step 4: Free tier profile setup\n✓ Step 5: Upgrade to tier 1\n✓ Step 6: Fill tier 1 brand story and add certifications\n✓ Step 7: Add team members and case studies\n✓ Step 8: Upgrade to tier 2\n✓ Step 9: Add multiple locations with map\n✓ Step 10: Add products\n✓ Step 11: Upgrade to tier 3\n✓ Step 12: Enable featured placement\n✓ Step 13: Verify complete public profile display\n✓ Single comprehensive test covering full journey\n✓ All features used in sequence\n✓ Data persistence verified across workflow\n✓ Execution time \u003c 8 minutes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-03T09:15:28.522263684+01:00","updated_at":"2025-11-03T12:37:32.93098421+01:00","closed_at":"2025-11-03T12:37:32.93098421+01:00","source_repo":".","labels":["e2e","integration","testing"]}
{"id":"ptnextjs-fedb","content_hash":"b21b1ae0d0bc26a490ae540422c83b934004fa6aeb8f2e45be9a4c04c2018ff3","title":"impl-frontend-page: Implement Subscription Page Route","description":"Priority: 1","notes":"Subscription page implemented with features: current tier display, tier comparison table, upgrade request form/status, authentication guards, loading states, error handling. 241 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.869446147+01:00","updated_at":"2025-11-05T07:29:44.412542051+01:00","closed_at":"2025-11-05T07:29:44.412542051+01:00","source_repo":"."}
{"id":"ptnextjs-ffb6","content_hash":"bfa550dbcdad04d69b7dfdf9aa338e9fcd97f11f6448a35ec43876ed92b19b09","title":"impl-frontend-nav: Update Navigation and Upgrade Prompts","description":"Priority: 1","notes":"Navigation updates complete: 1) Added Subscription link to VendorNavigation with CreditCard icon, 2) Updated UpgradePromptCard button from 'Contact Sales' to 'View Subscription Options' linking to /vendor/dashboard/subscription, 3) Updated DashboardSidebar button to link to subscription page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-04T15:44:30.870904913+01:00","updated_at":"2025-11-05T07:36:35.67690871+01:00","closed_at":"2025-11-05T07:36:35.67690871+01:00","source_repo":"."}
{"id":"ptnextjs-wpx","content_hash":"6201fb736a88a24c6ed33337adabf16772a6c64b2db7588c0c8b185d005b3016","title":"Add Media Gallery Tab to ProfileEditTabs","description":"Media Gallery Implementation Progress:\n\n✅ COMPLETED:\n- Added MediaGalleryItem interface to lib/types.ts with full typing\n- Added mediaGallery array field to Vendor schema (Tier 1+)\n- Schema supports both image uploads and video embeds (YouTube/Vimeo)\n- Analyzed existing patterns: native drag-drop, Card layouts, react-hook-form\n\n🔨 IN PROGRESS:\n- Refactoring MediaGalleryManager to follow codebase patterns\n- Pattern analysis: ExcelImportCard, BasicInfoForm, LocationsManagerCard\n\n📋 REMAINING:\n- Create MediaGalleryManager component (Card-based, native drag-drop)\n- Build media upload API endpoint\n- Integrate tab into ProfileEditTabs\n- Create public VendorMediaGallery display component\n- Write comprehensive tests (component + integration)\n- Add to vendor profile public page\n\n💡 KEY PATTERNS IDENTIFIED:\n- Native HTML5 drag-drop (no react-dropzone)\n- shadcn/ui Card components for layout\n- react-hook-form + zod for validation\n- uploadFile utility from lib/utils/file-upload.ts\n- useVendorDashboard() context hook\n- sonner for toast notifications\n\n📊 Estimated completion: 60% complete","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-11-08T10:22:47.92614767+01:00","updated_at":"2025-11-08T10:29:55.665334003+01:00","source_repo":"."}
